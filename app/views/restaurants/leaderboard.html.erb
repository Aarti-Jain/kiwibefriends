<% provide(:title, 'Leaderboard') %>
<div class="row">
  <aside class="col-md-4">
    <div class="leaderboard-aside">
      <h1>Leaderboard</h1>
      <%= form_with(url: leaderboard_path, method: "GET") do |form| %>
        <%= form.label :query, "Top Restaurants" %>
        <%= select(:query, :sort_by, [['Now'       , 1], 
                                      ['This Week' , 2],
                                      ['This Month', 3],
                                      ['This Year' , 4]]) %>
        <%= form.submit 'Search', class: "btn btn-primary btn-sm" %>
      <% end %>
    </div>
    
    <div class="top-three">
      <p>Top 3 Must Go!</p>
      <% count = 0 %>
      <% @restaurants.each do |rest| %>
        <% restaurant = Restaurant.find_by id: rest.id %>  
        <section class="user_info">
          <%= gravatar_for_restaurant restaurant %>
          <h1><%= restaurant.name %></h1>
          <span>
            <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span>
            <%= restaurant.description %>
          </span>
          <span><%= link_to "view profile", restaurant %></span>
        </section>
        <% count += 1 %>
        <% if count == 3 %>
          <% break %>
        <% end %>
      <% end %>
    </div>
  </aside>
  <div class="col-md-8">
    <div class="leaderboad-list">
      <% i = 1 %>
      <%= will_paginate %>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Rank</th>
            <th scope="col">Restaurant</th>
            <th scope="col">Rating</th>
            <th scope="col">Followers</th>
          </tr>
        </thead>
        <tbody>
          <% @restaurants.each do |rest| %>
          <% restaurant = Restaurant.find_by id: rest.id %>
          <tr>
            <th scope="row"><%= i %></th>
            <td>
              <%= gravatar_for_restaurant restaurant, size: 50 %>
              <%= link_to restaurant.name, restaurant %>
            </td>
            <td>
              <%= restaurant.average_rating %>
            </td>
            <td>
              <%= restaurant.restaurant_followers.count %>
            </td>
            <% i += 1 %>
          </tr>
          <% end %>
        </tbody>
      </table>
      <%= will_paginate %>
    </div>
  </div>
</div>