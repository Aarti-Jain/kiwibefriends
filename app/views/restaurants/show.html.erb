<% provide(:title, @restaurant.name) %>
<div class="row">
  <aside class="col-md-4">
    <section class='restaurant-profile-aside'>
      <%= render @restaurant %>
      <section class="stats">
        <%= render 'shared/restaurant_stats' %>
      </section>
      <div>
        <%= render 'follow_form' if logged_in? %>
      </div>
    </section>
    <section class="top-three">
      <div id="map" style="width: 340px; height: 300px;">
      <% provide :head_tags do %>
        <meta name='turbo-visit-control' content='reload'>
        <script>
          var data = '<%= [@restaurant].to_json %>';
          var restaurantAsArray = JSON.parse(data.replace(/&quot;/g,'"'));
          var restaurant = restaurantAsArray[0]
          document.addEventListener("DOMContentLoaded", function(){
            function initMap(lat, lng) {
              var myCoords = new google.maps.LatLng(lat, lng);
              var mapOptions = {center: myCoords, zoom: 10};
              var map = new google.maps.Map(document.getElementById('map'), mapOptions);

              var marker = new google.maps.Marker({
                  position: myCoords,
                  map: map,
                  title: restaurant["name"],
                  animation: google.maps.Animation.BOUNCE,
              });

              marker.addListener('click', function() {
                  var infowindow = new google.maps.InfoWindow({
                    content: `
                      <div>
                        <p>${restaurant["name"]}</p>
                        <a href='/restaurants/${restaurant["id"]}'>Reviews</a>
                      </div>`
                  });
                  infowindow.open(map, this);
              });
            }  
            map = initMap(parseFloat(restaurant["latitude"]), 
                          parseFloat(restaurant["longitude"]))
          });
        </script>
      <% end %>
      </div>
    </section>
  </aside>
  <div class="col-md-8">
  <% if @restaurant.microposts.any? %>
    <ol class="microposts">
      <%= render @microposts %>
    </ol>
    <%= will_paginate @microposts %>
  <% end %>
</div>
</div>